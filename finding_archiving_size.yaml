- name: Check all files
  find: 
    paths: /tmp
    file_type: any
    size: 2g
  register: files_to_archive
  #failed_when: files.matched < 10

- name: Remove previous tarFile
  file: 
    path: ~/test.tar.gz
    state: absent

- name: compress all the files in tar.gz
  archive:
    path: "{{ files_to_archive }}"
    dest: ~/test.tar.gz
    format: gz
  vars:
    files_to_archive: "{{ files_to_archive.files | map(attribute='path') | list }}"